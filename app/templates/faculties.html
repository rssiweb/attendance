{% extends 'lbase.html' %}

{% block bodywh %}
{%raw%}
<!-- Model add student -->
<h2 class="ui header">{{ heading }}</h2>
<div class="ui container">
    <div class="ui container" v-if="error">
        <div class="ui negative message">
            <i class="close icon" @click="clearError"></i>
            <div class="header">
                Unfortunately an error occured
            </div>
            {{ error }}
        </div>
    </div>

    <div class="ui container" v-if="message">
        <div class="ui info message">
            <i class="close icon"></i>
            <div class="header">
                Info
            </div>
            {{ message }}
        </div>
    </div>

    
    <div class="ui basic segment">
        <div class="ui icon input">
            <i class="search icon"></i>
            <input class="prompt" type="text" placeholder="Search ID, Name or Email..." v-model="searchTxt">
        </div>
    </div>

    <div class="ui segment" v-if="loading">
        <div class="ui active inverted dimmer">
            <div class="ui text loader">{{ loading }}</div>
        </div>
        <p><br/><br/><br/><br/></p>
    </div>

    <table class="ui compact sortable striped table" v-if="faculties && !loading && !error">
        <thead>
            <tr>
                <th>Faculty ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Gender</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            <tr v-for="faculty in filteredFaculties">
                <td><a href="#" @click="markFacultyToUpdate(faculty)">{{faculty.facultyId}}</a></td>
                <td>
                    {{faculty.name}}
                    <div class="ui mini olive horizontal label" v-if="faculty.admin">Admin</div>
                    <div class="ui mini grey horizontal label" v-if="!faculty.active">Inactive</div>
                </td>
                <td>{{faculty.email}}</td>
                <td>{{faculty.gender | capitalize}}</td>
                <td>

                    <button 
                    class="ui mini compact yellow button"
                    @click="showResetDialog(faculty)">
                    RESET PASSWORD
                </button>

                <button 
                class="ui mini compact button"
                v-bind:class="{ loading: faculty.stateLoading, disabled: faculty.stateLoading, olive: !faculty.active, orange: faculty.active }"
                @click="toogleActive(faculty)"
                v-if="!faculty.superUser"
                >
                {{faculty.active? "MARK INACTIVE" : "ACTIVE"}}
            </button>

            <button
            class="ui mini compact button disabled"
            v-bind:class="{ loading: faculty.loading, disabled: faculty.loading, olive: !faculty.admin, orange: faculty.admin}"
            @click="toogleAdmin(faculty)">
            {{faculty.admin? "REVOKE ADMIN ACCESS" : "PROMOTE TO ADMIN"}}
        </button>

    </td>
</tr>
</tbody>
</table>
<div class="ui container">
    <div class="ui sub header"><h3>Add Faculty</h3></div>
    <br/>
    <div class="ui form">
        <div class="ui fields" id="addFacultyForm">
            <div class="required field" :class="{disabled: isFacultyUpdate}">
                <label>Faculty ID</label>
                <input type="text" name="id" placeholder="Faculty ID" v-model="facultyToUpdate.facultyId"  :tabindex="isFacultyUpdate ? -1 : 0">
            </div>
            <div class="required field">
                <label>Name</label>
                <input type="text" name="name" placeholder="Full Name" v-model="facultyToUpdate.name">
            </div>
            <div class="required field">
                <label>Gender</label>
                <select name="gender" class="ui dropdown" v-model="facultyToUpdate.gender">
                    <option value="">Gender</option>
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                    <option value="others">Others</option>
                </select>
            </div>
            <div class="required field">
                <label>Contact</label>
                <input type="text" name="contact" placeholder="Contact Number" v-model="facultyToUpdate.contact">
            </div>
            <div class="required field" :class="{error: !validEmail}">
                <label>Email</label>
                <input type="text" name="email" placeholder="Email" v-model="facultyToUpdate.email">
            </div>
        </div>
        <div class="ui fields">
            <div class="required field" v-show="!isFacultyUpdate">
                <label>Password</label>
                <input type="password" name="password" placeholder="Password" v-model="facultyToUpdate.password">
            </div>
            <div class="required field" v-bind:class="{error: !matchPassword}" v-show="!isFacultyUpdate">
                <label>Confirm Password</label>
                <input type="password" name="confirmPassword" placeholder="Confirm Password" v-model="confirmPassword">
            </div>
        </div>
    </div>
    <div class="ui error message" v-if="!isValidPassword(facultyToUpdate.password).result">
      <ul class="list">
          <li v-for="err in isValidPassword(facultyToUpdate.password).message">{{err}}</li>
      </ul>
  </div>
  <div class="buttons">
    <button class="ui positive button" @click.prevent="updateFaculty" :class="{'loading disabled': addingOrUpdating, disabled: !enableFacultyBtn }">{{facultyBtnTxt}}</button>
    <button class="ui button" @click.prevent="resetFacultyForm">Reset</button>
</div>
</div>
</div>
<!-- Modals -->
<div id="resetModal" class="ui tiny modal">
    <div class="header">Reset {{facultyToReset.name}}'s Password</div>
    <div class="content">
        <div class="ui form">
            <div class="ui field">
                <label>Email</label>
                {{facultyToReset.email}}
            </div>
            <div class="ui field" :class="{'error': !isValidPassword(facultyToReset.password).result }">
                <label>New Password</label>
                <input type="password" name="password" placeholder="New Password" v-model="facultyToReset.password"  />
            </div>
            <div class="ui field" :class="{error: !newPasswordMatch}">
                <label>Confirm Password</label>
                <input type="password" name="confirmPassword" placeholder="Confirm Password" v-model="facultyToReset.confirmPassword"/>
            </div>
        </div>
        <div class="ui error message" v-show="!isValidPassword(facultyToReset.password).result">
            <ul class="ui list" v-if="isValidPassword(facultyToReset.password).message">
                <li v-for="message in isValidPassword(facultyToReset.password).message">{{message}}</li>
            </ul>
        </div>
    </div>
    <div class="actions">
        <button class="ui positive button" @click.prevent="resetPassword" :class="{'disabled': !facultyToReset.password || !newPasswordMatch}">Change Password</button>
        <button class="ui negative button">Cancel</button>
    </div>
</div>
{%endraw%}
{% endblock %}

{% block script %}
<script type="text/javascript" src="{{ url_for('static', filename='js/utils.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/faculty.js') }}"></script>
{% endblock%}