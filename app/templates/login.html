{% extends 'base.html' %}1

{% block style %}
    <style type="text/css">
    body {
      background-color: #DADADA;
    }
    body > .grid {
      height: 100%;
    }
    .image {
      margin-top: -100px;
    }
    .column {
      max-width: 450px;
    }
    </style>
{% endblock %}

{% block body %}

<div class="ui middle aligned center aligned grid">
     <div class="column">
    <h2 class="ui teal image header">
      <img src="http://via.placeholder.com/50x50" class="image">
      <div class="content">
        Log-in to your account
      </div>
    </h2>
    <form class="ui large form">
      <div class="ui stacked segment">
        <div class="field">
          <div class="ui left icon input">
            <i class="user icon"></i>
            <input type="text" name="email" placeholder="E-mail address">
          </div>
        </div>
        <div class="field">
          <div class="ui left icon input">
            <i class="lock icon"></i>
            <input type="password" name="password" placeholder="Password">
          </div>
        </div>
        <div id="login-btn" class="ui fluid large teal submit button">Login</div>
      </div>

      <div id="error-message" class="ui negative hidden message"></div>
    </form>

    <div class="ui message">
      Trouble signing in ? <a href="#">Reset Password</a>
    </div>
  </div>
</div>

{% endblock %}

{% block script%}
<script type="text/javascript">
    var showloading = function(){
        $('#login-btn').addClass('loading disabled');
        $('#error-message').addClass('hidden');
    };
    var hideLoading = function(){
        $('#login-btn').removeClass('loading disabled');
        $('#error-message').removeClass('hidden');
    };
    var saveToken = function(result){
            hideLoading();
            console.log(result);
            Cookies.set('auth_token',result.auth_token);
            console.log(Cookies.get('auth_token'));
            window.location = "/home";
    };
    var errorgettingToken = function(result){
        hideLoading();
        $('#error-message').html(result.responseJSON.message);
        console.log(result);
    }

    $('#login-btn').on('click', function( event ) {
        showloading();
        email = $('input[name="email"]').val()
        var password = $('input[name="password"]').val()
        var data = {
            email: email,
            password: password
        };

        $.ajax({
            type: 'POST',
            url: '/api/get_token',
            data: data,
            dataType: "json",
            success: saveToken,
            error: errorgettingToken 
        });
    });
</script>
{% endblock%}